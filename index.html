<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Quote App</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <h1>Stranger Things Quote App</h1>
      <p>
        You can add any quote you can remember from the TV show Stranger Things.
        <br />
        You can also search for a character's name to see some of the quotes said by the character.
      </p>
      <form>
        <label for="author"></label>
        <input type="text" id="author" required placeholder="Author's Name"/>
        <label for="quote"></label>
        <input type="text" id="quote" required  placeholder="Enter Quote"/>
        <button type="submit">Add Quote</button>
      </form>
      <img src="https://cdn.europosters.eu/image/750/posters/stranger-things-one-sheet-i68134.jpg" alt="Stranger Things Poster" />
    </header>

    <main>
      <ul id="quote-list"></ul>
    </main>

    <script>
      const quoteList = document.querySelector('#quote-list');

      async function getQuotes() {
        const response = await fetch('http://localhost:3000/quotes');
        const quotes = await response.json();
        return quotes;
      }

      async function addQuote(author, quote) {
        const response = await fetch('http://localhost:3000/quotes', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ author, quote })
        });
        const newQuote = await response.json();
        return newQuote;
      }

      async function deleteQuote(id) {
        const response = await fetch(`http://localhost:3000/quotes/${id}`, {
          method: 'DELETE'
        });
        const deletedQuote = await response.json();
        return deletedQuote;
      }

      function renderQuote(quote) {
        const li = document.createElement('li');
        li.innerHTML = `
          <h3>${quote.author}</h3>
          <p>${quote.quote}</p>
          <button class="delete-button" data-id="${quote.id}">Delete</button>
        `;
        quoteList.appendChild(li);
      }

      async function renderQuotes() {
        quoteList.innerHTML = '';
        const quotes = await getQuotes();
        quotes.forEach(renderQuote);
      }

      async function handleSubmit(event) {
        event.preventDefault();
        const authorInput = document.querySelector('#author');
        const quoteInput = document.querySelector('#quote');
        const author = authorInput.value;
        const quote = quoteInput.value;
        await addQuote(author, quote);
        authorInput.value = '';
        quoteInput.value = '';
        await renderQuotes();
      }

      async function handleDelete(event) {
        if (event.target.classList.contains('delete-button')) {
          const id = event.target.dataset.id;
          await deleteQuote(id);
          await renderQuotes();
        }
      }

      const form = document.querySelector('form');
      form.addEventListener('submit', handleSubmit);

      quoteList.addEventListener('click', handleDelete);

      (async function init() {
        await renderQuotes();
      })();
    </script>
  </body>
</html>
